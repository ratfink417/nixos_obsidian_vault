NixOS is a Linux distribution based on the purely functional package management system Nix, that is composed using modules and packages defined in the [Nixpkgs](2%20Glossary.md#^5e70bd) project. It is designed to be configured and built by a combination of configuration files maintained in a user's home directory and code written in the **Nix** language, a functional language that follows the paradigms behind the architecture of NixOS
# Reproducible Builds
The major draw to NixOS is it's declarative approach to system configuration, basically the whole system (packages, major application configs, hardware settings and pretty much anything you can configure in the system is done in the **Nix** language. The idea behind this method is that you can recreate the same system across any compatible machine expect to have the same packages, at the same version, with the same settings applied to the system, users and packages. Better yet, all of this is done with flat text files so if you manage all of it with **git** or any other version control for that matter, you'll effectively have a time machine for your system.

# NixOS Installation
OS installation is super straight forward, just download [the official ISO file](https://channels.nixos.org/nixos-23.11/latest-nixos-gnome-x86_64-linux.iso) and install it in a virtual machine with a big vdrv, somethin like 100GB or so. The large disk size is to support a large number of packages on the host you want to set up. NixOS keeps all versions of the package you use on the system so space fills up faster than on other distros.

# NixOS Configuration
NixOS comes installed with it's system configurations in _/etc/nixos/_ where 2 text files define your entire system configuration. 
 - The _hardware-configuration.nix_ file contains the declarations of your hardware configurations (NIC's Disks and all the other ones). 
 - The _configuration.nix_ file contains declarations of you system configuration (users, settings, packages and all the other ones as well, too) ^bd0a6e

An example of what the _hardware-configuration.nix_ file would look like
###### - Example hardware-configuration.nix -
``` nix
# Do not modify this file!  It was generated by ‘nixos-generate-config’
# and may be overwritten by future invocations.  Please make changes
# to /etc/nixos/configuration.nix instead.
{ config, lib, pkgs, modulesPath, ... }:

{
  imports =
    [ (modulesPath + "/profiles/qemu-guest.nix")
    ];

  boot.initrd.availableKernelModules = [ "ahci" "xhci_pci" "virtio_pci" "sr_mod" "virtio_blk" ];
  boot.initrd.kernelModules = [ ];
  boot.kernelModules = [ "kvm-amd" ];
  boot.extraModulePackages = [ ];

  fileSystems."/" =
    { device = "/dev/disk/by-uuid/aed6a590-f2d9-433e-b364-ece01eaef298";j
      fsType = "ext4";
    };

  swapDevices = [ ];

  # Enables DHCP on each ethernet and wireless interface. In case of scripted networking
  # (the default) this is the recommended approach. When using systemd-networkd it's
  # still possible to use this option, but it's recommended to use it in conjunction
  # with explicit per-interface declarations with `networking.interfaces.<interface>.useDHCP`.
  networking.useDHCP = lib.mkDefault true;
  # networking.interfaces.enp1s0.useDHCP = lib.mkDefault true;

  nixpkgs.hostPlatform = lib.mkDefault "x86_64-linux";
}
```
##
You might notice the helpful advice about not modifying this file, This stuff gets figured out at install time and if you wanna do something in here, it's probably because you know or have clear instruction on what to be changing in here.
###### - Example configuration.nix -

```nix
# Edit this configuration file to define what should be installed on
# your system.  Help is available in the configuration.nix(5) man page
# and in the NixOS manual (accessible by running ‘nixos-help’).

{ config, pkgs, ... }:

{
  imports =
    [ # Include the results of the hardware scan.
      ./hardware-configuration.nix
    ];

  # Bootloader.
  boot.loader.grub.enable = true;
  boot.loader.grub.device = "/dev/vda";
  boot.loader.grub.useOSProber = true;

  networking.hostName = "nixos"; # Define your hostname.
  # networking.wireless.enable = true;  # Enables wireless support via wpa_supplicant.

  # Configure network proxy if necessary
  # networking.proxy.default = "http://user:password@proxy:port/";
  # networking.proxy.noProxy = "127.0.0.1,localhost,internal.domain";

  # Enable networking
  networking.networkmanager.enable = true;

  # Set your time zone.
  time.timeZone = "America/Los_Angeles";

  # Select internationalisation properties.
  i18n.defaultLocale = "en_US.UTF-8";

  i18n.extraLocaleSettings = {
    LC_ADDRESS = "en_US.UTF-8";
    LC_IDENTIFICATION = "en_US.UTF-8";
    LC_MEASUREMENT = "en_US.UTF-8";
    LC_MONETARY = "en_US.UTF-8";
    LC_NAME = "en_US.UTF-8";
    LC_NUMERIC = "en_US.UTF-8";
    LC_PAPER = "en_US.UTF-8";
    LC_TELEPHONE = "en_US.UTF-8";
    LC_TIME = "en_US.UTF-8";
  };

  # Configure keymap in X11
  services.xserver = {
    layout = "us";
    xkbVariant = "";
  };

  # Define a user account. Don't forget to set a password with ‘passwd’.
  users.users.johnny = {
    isNormalUser = true;
    description = "johnny";
    extraGroups = [ "networkmanager" "wheel" ];
    packages = with pkgs; [];
  };
:
  # Allow unfree packages
  nixpkgs.config.allowUnfree = true;
:
  # List packages installed in system profile. To search, run:
  # $ nix search wget
  environment.systemPackages = with pkgs; [
    neovim # Do not forget to add an editor to edit configuration.nix! The Nano editor is also installed by default.
    wget
    git
    openssh
  ];
:
  # Some programs need SUID wrappers, can be configured further or are
  # started in user sessions.
  # programs.mtr.enable = true;
  # programs.gnupg.agent = {
  #   enable = true;
  #   enableSSHSupport = true;
  # };
:
  # List services that you want to enable:
:
  # Enable the OpenSSH daemon.
  services.openssh.enable = true;
:
  # Open ports in the firewall.
  # networking.firewall.allowedTCPPorts = [ ... ];
  # networking.firewall.allowedUDPPorts = [ ... ];
  # Or disable the firewall altogether.
  # networking.firewall.enable = false;
:
  # This value determines the NixOS release from which the default
  # settings for stateful data, like file locations and database versions
  # on your system were taken. It‘s perfectly fine and recommended to leave
  # this value at the release version of the first install of this system.
  # Before changing this value read the documentation for this option
  # (e.g. man configuration.nix or on https://nixos.org/nixos/options.html).
  system.stateVersion = "23.11"; # Did you read the comment?
 
  # Enable NixOS flakes management
  nix.settings.experimental-features = ["nix-command" "flakes"];
}
```

##
This _configuration.nix_ has a couple of modifications made to it from the one that comes with the installation. I added `vim`, `git` and some other packages and enabled the `sshd` service.
## Flakes
Flakes is a management feature of Nix packages that simplifies usability and reproducibility of Nix installations. They manage the dependencies of multiple Nix [expressions](2%20Glossary.md#^d71ed3) which are the primary protocols for specifying packages. Flakes implements these protocols in a consistent schema with a common set of policies for managing packages. When you see references to a [[2 Glossary#^acc8a0|flake]] in this guide, I'm talking about the directory structure where you are managing these nix files for your system.
